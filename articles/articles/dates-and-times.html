<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dates and times • googlesheets4</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../../tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../tidyverse-2.css" rel="stylesheet">
<!--optional theme--><link href="../../.css" rel="stylesheet">
<meta property="og:title" content="Dates and times">
<meta property="og:description" content="googlesheets4">
<meta property="og:image" content="https://googlesheets4.tidyverse.org/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../../index.html">googlesheets4</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of the <a href="https://tidyverse.org">tidyverse</a></span>
          <span class="version version-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../articles/googlesheets4.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/read-sheets.html">Read Sheets</a>
    </li>
    <li>
      <a href="../../articles/articles/write-sheets.html">Write Sheets</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Special topics</li>
    <li>
      <a href="../../articles/articles/auth.html">googlesheets4 auth</a>
    </li>
    <li>
      <a href="../../articles/articles/dates-and-times.html">Dates and times</a>
    </li>
    <li>
      <a href="../../articles/articles/find-identify-sheets.html">Find and identify Sheets</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Connections to other packages</li>
    <li>
      <a href="../../articles/articles/drive-and-sheets.html">Using googlesheets4 with googledrive</a>
    </li>
    <li>
      <a href="../../articles/articles/fun-with-googledrive-and-readxl.html">Fun with googledrive and readxl</a>
    </li>
    <li>
      <a href="../../articles/articles/googlesheets4-reprex.html">How to create a googlesheets4 reprex</a>
    </li>
    <li class="divider">
    <li>
      <a href="../../articles/index.html">More...</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Blog posts</li>
    <li>
      <a href="https://www.tidyverse.org/blog/2020/05/googlesheets4-0-2-0/">googlesheets4 0.2.0</a>
    </li>
    <li class="divider">
    <li>
      <a href="../../news/index.html">Change log</a>
    </li>
  </ul>
</li>
        <li>
  <a href="https://github.com/tidyverse/googlesheets4/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="dates-and-times_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="dates-and-times_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="dates-and-times_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Dates and times</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/googlesheets4/blob/master/vignettes/articles/dates-and-times.Rmd"><code>vignettes/articles/dates-and-times.Rmd</code></a></small>
      <div class="hidden name"><code>dates-and-times.Rmd</code></div>

    </div>

    
    
<!-- dates-and-times.Rmd is generated from dates-and-times.Rmd.orig.Rmd. Please edit that file -->
<p>This article provides advice on reading and writing datetimes with Google Sheets, specifically around the matter of time zones.</p>
<p>A related issue is how datetimes are formatted for presentation in the Sheet itself. You can read more about these formats in the <a href="https://developers.google.com/sheets/api/guides/formats#date_and_time_format_patterns">Date and time format patterns section of the Sheets API docs</a>. At the time of writing, googlesheets4 provides no user-friendly way to address these formats, although it may do so in the future.</p>
<div id="attach-packages-and-do-auth" class="section level2">
<h2 class="hasAnchor">
<a href="#attach-packages-and-do-auth" class="anchor"></a>Attach packages and do auth</h2>
<p>Attach googlesheets4.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/googlesheets4">googlesheets4</a></span><span class="op">)</span></code></pre></div>
<p>Since we eventually create and edit Sheets, we also auth here in a hidden chunk. If you run this code, you should expect auth to happen.</p>
<p>The lubridate package (<a href="https://lubridate.tidyverse.org">lubridate.tidyverse.org</a>) is useful for this exploration, so we attach it now.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://lubridate.tidyverse.org">lubridate</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
</div>
<div id="how-to-work-with-time-zones-in-a-google-sheet" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-work-with-time-zones-in-a-google-sheet" class="anchor"></a>How to work with time zones in a Google Sheet</h2>
<p>You don’t.</p>
<p>Literally, you can’t.</p>
<p>I know this sounds very harsh, but it is the truth. Google Sheets offer essentially no support for time zones and your life will be simpler if you just make peace with this and accept that you will be looking at UTC times in Sheets.</p>
<p>A short demo: in R, capture the current time as <code>tt</code> and reveal the current time zone. Note that <code>tt</code> is displayed in R according to this time zone.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "2020-04-23 12:48:57 PDT"</span>

<span class="fu"><a href="https://rdrr.io/r/base/timezones.html">Sys.timezone</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "America/Vancouver"</span></code></pre></div>
<p>Write the <code>tt</code> datetime to a Sheet, configured with the same time zone as the local R session, and create another cell that captures the exact text presented in the browser UI for <code>tt</code>. Read this back into R.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  datetime <span class="op">=</span> <span class="va">tt</span>,
  as_displayed <span class="op">=</span> <span class="fu"><a href="../../reference/gs4_formula.html">gs4_formula</a></span><span class="op">(</span><span class="st">"=TO_TEXT(A2)"</span><span class="op">)</span>
<span class="op">)</span>

<span class="op">(</span><span class="va">ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/gs4_create.html">gs4_create</a></span><span class="op">(</span>
  <span class="st">"no-time-zone-effect"</span>,
  sheets <span class="op">=</span> <span class="va">dat</span>,
  timeZone <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/timezones.html">Sys.timezone</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Creating new Sheet: "no-time-zone-effect"</span>
<span class="co">#&gt;   Spreadsheet name: no-time-zone-effect</span>
<span class="co">#&gt;                 ID: 1rH4nOOFBFvqCLEcYqaPjMIPj7EHfcT21tLTRL2FbHx0</span>
<span class="co">#&gt;             Locale: en_US</span>
<span class="co">#&gt;          Time zone: America/Vancouver</span>
<span class="co">#&gt;        # of sheets: 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Sheet name): (Nominal extent in rows x columns)</span>
<span class="co">#&gt;          dat: 2 x 2</span>

<span class="fu"><a href="../../reference/range_read.html">read_sheet</a></span><span class="op">(</span><span class="va">ss</span><span class="op">)</span>
<span class="co">#&gt; Reading from "no-time-zone-effect"</span>
<span class="co">#&gt; Range "dat"</span>
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;   datetime            as_displayed       </span>
<span class="co">#&gt;   &lt;dttm&gt;              &lt;chr&gt;              </span>
<span class="co">#&gt; 1 2020-04-23 19:48:57 2020-04-23 19:48:58</span></code></pre></div>
<p>Note that the <code>tt</code> datetime is displayed differently in Sheets than it is locally in R. Sheets presents datetimes in Coordinated Universal Time (time zone Etc/UTC), even if the Sheet’s metadata specifies a different time zone, such as America/Vancouver.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="http://lubridate.tidyverse.org/reference/with_tz.html">with_tz</a></span><span class="op">(</span><span class="va">tt</span>, <span class="st">"Etc/UTC"</span><span class="op">)</span>
<span class="co">#&gt; [1] "2020-04-23 19:48:57 UTC"</span></code></pre></div>
<p>If you want to understand more about datetimes in R, in Sheets, and how you can sort of hack around this time zone problem, keep reading.</p>
</div>
<div id="need-to-know-basics-of-datetimes" class="section level2">
<h2 class="hasAnchor">
<a href="#need-to-know-basics-of-datetimes" class="anchor"></a>Need-to-know basics of datetimes</h2>
<p>Datetimes are a complicated topic. Here we dramatically oversimplify things, in the name of making a reader who is new to all of this at least minimally functional.</p>
<p>The main system used to represent times in the computing world is Unix epoch time:</p>
<blockquote>
<p>A moment in time is represented by the number of seconds that have elapsed since 1 January 1970 00:00:00 UTC.</p>
</blockquote>
<p>The “UTC” part stands for “Coordinated Universal Time”. Yes, the order of the letters is strangely different from the words! It’s a great metaphor for this entire subject, because nothing is as simple as you’d like. Just accept it and move on. UTC is what you may already think of as “Greenwich Mean Time”, if you’ve ever encountered that term.</p>
<p>There are three wrinkles we must acknowledge, even when oversimplifying:</p>
<ol style="list-style-type: decimal">
<li>Time zones. We don’t all live in Greenwich, England, so local times are described by an offset from UTC.
<ul>
<li>I live in Vancouver, British Columbia, which is 8 hours behind UTC (UTC−08:00). Or, at least, it is part of the year …</li>
</ul>
</li>
<li>Daylight savings time. Lots of places change their clocks twice a year. UTC does not! UTC “just is”. This means that your UTC offset is one number part of the year and another number part of the year.
<ul>
<li>My offset is -08:00 during standard time, but is -07:00 during daylight savings (roughly March - October).</li>
</ul>
</li>
<li>Spreadsheets are special. Spreadsheets use a different form of epoch time. Their epoch or origin is usually around 1900 and they keep track of how many <em>days</em> have elapsed since the epoch (not seconds, like Unix epoch time). These are sometimes called “serial dates” or “serial numbers”.
<ul>
<li>Google Sheets use an epoch of 30 December 1899 00:00:00 UTC.<br>
</li>
<li>Horrors I will spare you: different epochs for different spreadsheet applications (or versions thereof) and the Lotus 1-2-3 leap year bug.</li>
</ul>
</li>
</ol>
<p>You can read more in the <a href="https://developers.google.com/sheets/api/guides/concepts#datetime_serial_numbers">Sheets API docs about Date/Time serial numbers</a>.</p>
</div>
<div id="datetimes-in-r" class="section level2">
<h2 class="hasAnchor">
<a href="#datetimes-in-r" class="anchor"></a>Datetimes in R</h2>
<p>R uses Unix epoch time.</p>
<p>R uses the <a href="https://rdrr.io/r/base/DateTimeClasses.html">POSIXct</a> class to represent datetimes. (Yes, there’s also <code>POSIXlt</code>, but I recommend and will focus on <code>POSIXct</code>.)</p>
<p>If you ask for the current time, R prints it formatted for your time zone (or, at least, it tries). You can also ask R to reveal what it thinks your time zone is.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "2020-04-23 12:49:04 PDT"</span>

<span class="fu"><a href="https://rdrr.io/r/base/timezones.html">Sys.timezone</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "America/Vancouver"</span></code></pre></div>
<p>The time zone is <strong>purely matter of display</strong>, but it’s a really nice touch! It is comforting to get a time printed by R that matches your experience of what time it is, based on looking at the clock on your wall (“clock time”).</p>
<p>lubridate’s <code><a href="http://lubridate.tidyverse.org/reference/with_tz.html">with_tz()</a></code> function lets you explicitly associate a datetime with a time zone, e.g. your own or any other time zone recognized by your system. And this, in turn, affects how the time is formatted for human eyeballs.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="http://lubridate.tidyverse.org/reference/with_tz.html">with_tz</a></span><span class="op">(</span><span class="va">tt</span>, tzone <span class="op">=</span> <span class="st">"America/Vancouver"</span><span class="op">)</span>
<span class="co">#&gt; [1] "2020-04-23 12:49:04 PDT"</span>

<span class="fu"><a href="http://lubridate.tidyverse.org/reference/with_tz.html">with_tz</a></span><span class="op">(</span><span class="va">tt</span>, tzone <span class="op">=</span> <span class="st">"America/Denver"</span><span class="op">)</span>
<span class="co">#&gt; [1] "2020-04-23 13:49:04 MDT"</span>

<span class="fu"><a href="http://lubridate.tidyverse.org/reference/with_tz.html">with_tz</a></span><span class="op">(</span><span class="va">tt</span>, tzone <span class="op">=</span> <span class="st">"Etc/UTC"</span><span class="op">)</span>
<span class="co">#&gt; [1] "2020-04-23 19:49:04 UTC"</span></code></pre></div>
<p><strong>Google Sheets have no ability to display a moment in time according to a specified time zone.</strong> Yes, each Sheet has an associated time zone, but this is not what it influences, even though you might expect or hope for that.</p>
<p>When we read datetimes out of a Google Sheet, we must:</p>
<ul>
<li>Convert from days to seconds.</li>
<li>Adjust for Unix epoch versus spreadsheet epoch.</li>
<li>Use the resulting number to construct an instance of <code>POSIXct</code>.</li>
</ul>
<p>When we write a datetime to a Google Sheet, we must:</p>
<ul>
<li>Convert from seconds to days.</li>
<li>Adjust for the spreadsheet epoch versus Unix epoch.</li>
<li>Use the resulting number to create an instance of the <a href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets/cells#celldata"><code>CellData</code></a> schema.</li>
</ul>
</div>
<div id="datetimes-in-google-sheets" class="section level2">
<h2 class="hasAnchor">
<a href="#datetimes-in-google-sheets" class="anchor"></a>Datetimes in Google Sheets</h2>
<p>Google Sheets use a spreadsheet-y version of epoch time. A datetime cell holds a so-called serial number, which is the elapsed days since the epoch of 30 December 1899 00:00:00 UTC. This number is then displayed in a more human-friendly way, according to a special token string. Currently googlesheets4 doesn’t offer any explicit support for dealing with these <a href="https://developers.google.com/sheets/api/guides/formats#date_and_time_format_patterns">format strings</a>, although one day it probably will.</p>
<p>Let’s gain some intuition by looking at datetimes shortly after the epoch and inspecting the underlying serial numbers. In a hidden chunk, we create a Sheet and read it into R.</p>
<pre><code>#&gt; Creating new Sheet: "near-the-epoch"
#&gt; Reading from "near-the-epoch"
#&gt; Range "dat"
#&gt; # A tibble: 2 x 2
#&gt;   datetime            serial_number
#&gt;   &lt;dttm&gt;                      &lt;dbl&gt;
#&gt; 1 1899-12-30 12:00:00          0.5 
#&gt; 2 1899-12-31 18:00:00          1.75</code></pre>
<p>1899-12-30 12:00:00 is noon on the day that is the Google Sheets epoch. Its underlying serial number is 0.5, because one half-day has elapsed since the epoch. 1899-12-31 18:00:00 is 6pm in the evening on the day after the epoch. Its underlying serial number is 1.75, because it’s one plus three-quarters of a day since the epoch.</p>
<p>Every Google Sheet has an associated time zone. It is included in the metadata returned by <code><a href="../../reference/gs4_get.html">gs4_get()</a></code>, like the locale, and is revealed by default when we print a Sheets ID.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/gs4_example.html">gs4_example</a></span><span class="op">(</span><span class="st">"gapminder"</span><span class="op">)</span> <span class="op">%&gt;%</span>
   <span class="fu"><a href="../../reference/gs4_get.html">gs4_get</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   Spreadsheet name: gapminder</span>
<span class="co">#&gt;                 ID: 1U6Cf_qEOhiR9AZqTqS3mbMF3zt2db48ZP5v3rkrAEJY</span>
<span class="co">#&gt;             Locale: en_US</span>
<span class="co">#&gt;          Time zone: America/Los_Angeles</span>
<span class="co">#&gt;        # of sheets: 5</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Sheet name): (Nominal extent in rows x columns)</span>
<span class="co">#&gt;       Africa: 625 x 6</span>
<span class="co">#&gt;     Americas: 301 x 6</span>
<span class="co">#&gt;         Asia: 397 x 6</span>
<span class="co">#&gt;       Europe: 361 x 6</span>
<span class="co">#&gt;      Oceania: 25 x 6</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Named range): (A1 range)        </span>
<span class="co">#&gt;        canada: 'Americas'!A38:F49</span>

<span class="va">meta</span><span class="op">$</span><span class="va">time_zone</span>
<span class="co">#&gt; [1] "America/Los_Angeles"</span></code></pre></div>
<p>However, this time zone has a very different impact – much <em>less</em> impact – on the user experience than the time zone in R.</p>
<p>The Sheets’ time zone does <strong>not</strong> influence the display of datetimes. There is no way to request that a datetime be displayed according to a specific time zone – not via the Sheet’s time zone, not via the format string, and not via a Sheets function.</p>
<p>Datetimes in Google Sheets are fundamentally UTC-based and always display as such.</p>
<p>If you want to see “9:14 am” in your Sheet, you must make sure the serial number in that cell represents 9:14 in the morning, UTC time.</p>
<p>As far as I can tell, here is the only effect of a Sheet’s time zone: The formulas <code>=NOW()</code> and <code>=TODAY()</code> take the local clock time or date, according to the the Sheet’s time zone, and construct the UTC moment or date that will display as that time or date. Therefore <code>=NOW()</code>, especially, is almost misleading! It does not capture the current moment, in UTC, but instead fabricates a UTC moment that matches current local clock time.</p>
<p>This suggests various hacks if you truly, deeply want to see specific clock times in your Sheet, for non-UTC time zones.</p>
<p>Starting with the UTC moments, you must determine and apply the offset yourself. At a very crude level, this can be done from first principles with datetime arithmetic in the Sheet (“Vancouver is −08:00, so subtract 8 hours”). But then there’s daylight savings time and other complexities (“Except, during DST, subtract 7 hours.”). In reality, no mere mortal will <em>ever</em> get this right, in general. If you doubt me, please watch the YouTube video <a href="https://youtu.be/-5wpm-gesOY">Computerphile’s “The Problem with Time &amp; Timezones”</a>.</p>
<p>You need to use external, authoritative offset information, either within R or in the Sheet. Below, we show how to do this in R. In Sheets, people tend to use Google Apps script and solutions based on <a href="https://momentjs.com">moment.js</a>.</p>
</div>
<div id="worked-example" class="section level2">
<h2 class="hasAnchor">
<a href="#worked-example" class="anchor"></a>Worked example</h2>
<p>Let’s make all of this concrete. We construct a data frame in R with a datetime and various versions of it that explore time zone issues. We also include a couple of Google Sheet formulas, to trigger some datetime work once the data is written into a Sheet. We sketch the construction of this data frame here, with considerable abuse of notation (mixing R code and Sheets formulas):</p>
<table class="table">
<colgroup>
<col width="10%">
<col width="68%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th>what</th>
<th>datetime</th>
<th>serial_number</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>moment</td>
<td><code><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time()</a></code></td>
<td><code>=ARRAYFORMULA(TO_PURE_NUMBER(B2:B))</code></td>
</tr>
<tr class="even">
<td>moment_ny</td>
<td><code><a href="http://lubridate.tidyverse.org/reference/with_tz.html">with_tz(moment, tzone = "America/New_York")</a></code></td>
<td></td>
</tr>
<tr class="odd">
<td>moment_utc</td>
<td><code><a href="http://lubridate.tidyverse.org/reference/with_tz.html">with_tz(moment, tzone = "Etc/UTC")</a></code></td>
<td></td>
</tr>
<tr class="even">
<td>moment_ny_force_utc</td>
<td><code><a href="http://lubridate.tidyverse.org/reference/force_tz.html">force_tz(moment_ny, tzone = "Etc/UTC")</a></code></td>
<td></td>
</tr>
<tr class="odd">
<td>=NOW()</td>
<td><code>=NOW()</code></td>
<td></td>
</tr>
<tr class="even">
<td>=(DATE(moment_utc) + TIME(moment_utc))</td>
<td>
<code>=(DATE({year},{month},{day})+time({hour},{minute},{round(second, 1)}))</code> where <code>year</code>, <code>month</code>, etc. are computed from <code>moment_utc</code>
</td>
<td></td>
</tr>
</tbody>
</table>
<p>Capture the current <code>moment</code> in time, with <code><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time()</a></code>, which has no explicit time zone. Store versions of <code>moment</code> with explicit time zones: America/New_York and Etc/UTC. Use <code><a href="http://lubridate.tidyverse.org/reference/force_tz.html">lubridate::force_tz()</a></code> to create a new moment in time: the moment in UTC that has the same clock time as the original <code>moment</code> in New York.</p>
<p>The first Sheets formula we use is <code>=NOW()</code>, which you might expect to be the equivalent of R’s <code><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time()</a></code>. But it’s more like <code><a href="http://lubridate.tidyverse.org/reference/force_tz.html">force_tz(Sys.time(), tzone = "Etc/UTC")</a></code>. The second formula we construct is more elaborate. It uses datetime functions in Sheets to explicitly construct <code>moment_utc</code> in the Sheet. The last column uses <code>=TO_PURE_NUMBER()</code> to reveal the underlying serial numbers for all of the datetimes.</p>
<p>Create 3 Sheets, with different approaches to the time zone:</p>
<ul>
<li>No explicit specification of time zone. It’s hard to say what you’ll get here!</li>
<li>America/New_York</li>
<li>Etc/UTC</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ss_xx</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/gs4_create.html">gs4_create</a></span><span class="op">(</span><span class="st">"tz-default"</span><span class="op">)</span>
<span class="co">#&gt; Creating new Sheet: "tz-default"</span>
<span class="va">ss_ny</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/gs4_create.html">gs4_create</a></span><span class="op">(</span><span class="st">"tz-america-new-york"</span>, timeZone <span class="op">=</span> <span class="st">"America/New_York"</span><span class="op">)</span>
<span class="co">#&gt; Creating new Sheet: "tz-america-new-york"</span>
<span class="va">ss_utc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/gs4_create.html">gs4_create</a></span><span class="op">(</span><span class="st">"tz-etc-utc"</span>, timeZone <span class="op">=</span> <span class="st">"Etc/UTC"</span><span class="op">)</span>
<span class="co">#&gt; Creating new Sheet: "tz-etc-utc"</span>

<span class="va">show_timezone</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ss</span><span class="op">)</span> <span class="fu"><a href="../../reference/gs4_get.html">gs4_get</a></span><span class="op">(</span><span class="va">ss</span><span class="op">)</span><span class="op">$</span><span class="va">time_zone</span>

<span class="fu">show_timezone</span><span class="op">(</span><span class="va">ss_xx</span><span class="op">)</span>
<span class="co">#&gt; [1] "Etc/GMT"</span>
<span class="fu">show_timezone</span><span class="op">(</span><span class="va">ss_ny</span><span class="op">)</span>
<span class="co">#&gt; [1] "America/New_York"</span>
<span class="fu">show_timezone</span><span class="op">(</span><span class="va">ss_utc</span><span class="op">)</span>
<span class="co">#&gt; [1] "Etc/UTC"</span></code></pre></div>
<p>Capture the current <code>moment</code> with <code><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time()</a></code>, construct the data frame described above, and write it into each of the prepared Google Sheets.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">populate_sheets</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ss_xx</span>, <span class="va">ss_ny</span>, <span class="va">ss_utc</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Writing to "tz-default"</span>
<span class="co">#&gt; Writing to sheet "Sheet1"</span>
<span class="co">#&gt; Editing "tz-default"</span>
<span class="co">#&gt; Resizing one or more columns in "Sheet1"</span>
<span class="co">#&gt; Editing "tz-default"</span>
<span class="co">#&gt; Editing sheet "Sheet1"</span>
<span class="co">#&gt; Writing to "tz-america-new-york"</span>
<span class="co">#&gt; Writing to sheet "Sheet1"</span>
<span class="co">#&gt; Editing "tz-america-new-york"</span>
<span class="co">#&gt; Resizing one or more columns in "Sheet1"</span>
<span class="co">#&gt; Editing "tz-america-new-york"</span>
<span class="co">#&gt; Editing sheet "Sheet1"</span>
<span class="co">#&gt; Writing to "tz-etc-utc"</span>
<span class="co">#&gt; Writing to sheet "Sheet1"</span>
<span class="co">#&gt; Editing "tz-etc-utc"</span>
<span class="co">#&gt; Resizing one or more columns in "Sheet1"</span>
<span class="co">#&gt; Editing "tz-etc-utc"</span>
<span class="co">#&gt; Editing sheet "Sheet1"</span></code></pre></div>
<p>First, let’s look at <code>dat</code>, the data frame we sent.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span>
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   what                datetime   serial_number                      </span>
<span class="co">#&gt;   &lt;chr&gt;               &lt;list&gt;     &lt;fmla&gt;                             </span>
<span class="co">#&gt; 1 moment              &lt;dttm [1]&gt; =ARRAYFORMULA(TO_PURE_NUMBER(B2:B))</span>
<span class="co">#&gt; 2 moment_ny           &lt;dttm [1]&gt; NA                                 </span>
<span class="co">#&gt; 3 moment_utc          &lt;dttm [1]&gt; NA                                 </span>
<span class="co">#&gt; 4 moment_ny_utc_force &lt;dttm [1]&gt; NA                                 </span>
<span class="co">#&gt; 5 =NOW()              &lt;fmla&gt;     NA                                 </span>
<span class="co">#&gt; 6 =DATE(moment_utc)   &lt;fmla&gt;     NA</span></code></pre></div>
<p>That’s hard to parse since the <code>datetime</code> column is a list-column. Here’s a different look, with the most natural character representation of that column.</p>
<pre><code>#&gt; # A tibble: 6 x 3
#&gt;   what             datetime                     serial_number                      
#&gt;   &lt;chr&gt;            &lt;chr&gt;                        &lt;fmla&gt;                             
#&gt; 1 moment           2020-04-23 12:49:20 PDT      =ARRAYFORMULA(TO_PURE_NUMBER(B2:B))
#&gt; 2 moment_ny        2020-04-23 15:49:20 EDT      NA                                 
#&gt; 3 moment_utc       2020-04-23 19:49:20 UTC      NA                                 
#&gt; 4 moment_ny_utc_f… 2020-04-23 15:49:20 UTC      NA                                 
#&gt; 5 =NOW()           =NOW()                       NA                                 
#&gt; 6 =DATE(moment_ut… =(DATE(2020,4,23)+time(19,4… NA</code></pre>
<p>Read the Sheets back into R, the Sheet with no explicit time zone set.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/range_read.html">read_sheet</a></span><span class="op">(</span><span class="va">ss_xx</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Reading from "tz-default"</span>
<span class="co">#&gt; Range "Sheet1"</span>
<span class="co">#&gt;                  what            datetime serial_number</span>
<span class="co">#&gt; 1              moment 2020-04-23 19:49:20      43944.83</span>
<span class="co">#&gt; 2           moment_ny 2020-04-23 19:49:20      43944.83</span>
<span class="co">#&gt; 3          moment_utc 2020-04-23 19:49:20      43944.83</span>
<span class="co">#&gt; 4 moment_ny_utc_force 2020-04-23 15:49:20      43944.66</span>
<span class="co">#&gt; 5              =NOW() 2020-04-23 19:49:22      43944.83</span>
<span class="co">#&gt; 6   =DATE(moment_utc) 2020-04-23 19:49:20      43944.83</span>
<span class="fu"><a href="../../reference/range_read.html">read_sheet</a></span><span class="op">(</span><span class="va">ss_ny</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Reading from "tz-america-new-york"</span>
<span class="co">#&gt; Range "Sheet1"</span>
<span class="co">#&gt;                  what            datetime serial_number</span>
<span class="co">#&gt; 1              moment 2020-04-23 19:49:20      43944.83</span>
<span class="co">#&gt; 2           moment_ny 2020-04-23 19:49:20      43944.83</span>
<span class="co">#&gt; 3          moment_utc 2020-04-23 19:49:20      43944.83</span>
<span class="co">#&gt; 4 moment_ny_utc_force 2020-04-23 15:49:20      43944.66</span>
<span class="co">#&gt; 5              =NOW() 2020-04-23 15:49:23      43944.66</span>
<span class="co">#&gt; 6   =DATE(moment_utc) 2020-04-23 19:49:20      43944.83</span>
<span class="fu"><a href="../../reference/range_read.html">read_sheet</a></span><span class="op">(</span><span class="va">ss_utc</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Reading from "tz-etc-utc"</span>
<span class="co">#&gt; Range "Sheet1"</span>
<span class="co">#&gt;                  what            datetime serial_number</span>
<span class="co">#&gt; 1              moment 2020-04-23 19:49:20      43944.83</span>
<span class="co">#&gt; 2           moment_ny 2020-04-23 19:49:20      43944.83</span>
<span class="co">#&gt; 3          moment_utc 2020-04-23 19:49:20      43944.83</span>
<span class="co">#&gt; 4 moment_ny_utc_force 2020-04-23 15:49:20      43944.66</span>
<span class="co">#&gt; 5              =NOW() 2020-04-23 19:49:25      43944.83</span>
<span class="co">#&gt; 6   =DATE(moment_utc) 2020-04-23 19:49:20      43944.83</span></code></pre></div>
<p>Main conclusions:</p>
<ul>
<li>All 3 versions of <code>moment</code> result in the same serial number in all 3 Sheets. Lesson: in R, time zone is merely a matter of display and, in Sheets, there is only UTC.</li>
<li>
<code>moment_ny_utc_force</code> (forcing <code>moment</code>s NY clock time into UTC) results in the same serial number in all 3 Sheets. Lesson: If you want to see a specify clock time in the Sheet, force this on the R side, before writing to Sheets. But realize that you have fudged the datetime data in order to get the desired display.</li>
<li>
<code>=NOW()</code> is one of the few things affected by a Sheet’s time zone (along with <code>=TODAY()</code>. It allows you to force the Sheet’s clock time into UTC.</li>
</ul>
<p>Clean up.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/gs4_find.html">gs4_find</a></span><span class="op">(</span><span class="st">"tz-"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">googledrive</span><span class="fu">::</span><span class="fu"><a href="https://googledrive.tidyverse.org/reference/drive_trash.html">drive_trash</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Files trashed:</span>
<span class="co">#&gt;   * tz-etc-utc: 1xUiNXYsk6nDMmgDq8E5FhBwJA6Zg1XCyhkuQISI91As</span>
<span class="co">#&gt;   * tz-america-new-york: 1RYjk25FKJH2QRpfT1fHGmomeO2BQ5VqErWQADLGeFJI</span>
<span class="co">#&gt;   * tz-default: 1X9Zqe--GLw6X4jajyHVb9XmKh-AiLMwZKk_g5GoJl3Y</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="tidyverse">
  <p>googlesheets4 is a part of the <strong>tidyverse</strong>, an ecosystem of packages designed with common APIs and a shared philosophy. Learn more at <a href="https://tidyverse.org">tidyverse.org</a>.</p>
</div>

<div class="author">
  <p>
    Developed by <a href="https://jennybryan.org">Jennifer Bryan</a>, <a href="https://www.rstudio.com"><img src="https://www.tidyverse.org/rstudio-logo.svg" alt="RStudio" height="24"></a>.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
